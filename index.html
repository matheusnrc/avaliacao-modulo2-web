<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Monitoramento da Coleta de Lixo - São Carlos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <style>
      body {
        background-color: #f5f7fa;
      }

      .navbar-brand span {
        font-weight: 600;
      }

      .card-dashboard {
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .card-dashboard:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: 600;
      }

      .badge-status-ativo {
        background-color: #198754;
      }

      .badge-status-inativo {
        background-color: #dc3545;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
      <div class="container">
        <a class="navbar-brand" href="#">
          <span>Coleta Inteligente - São Carlos</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Alternar navegação"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#dashboard">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#cadastro">Pontos de Coleta</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#ocorrencias">Ocorrências</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#rotas">Consulta de Rotas</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container my-4">
      <section id="dashboard" aria-label="Visão geral do sistema">
        <div class="mb-3">
          <h1 class="h3 mb-1">Monitoramento inteligente da coleta de lixo</h1>
          <p class="text-muted mb-0">
            Prototipo de aplicação web para apoiar moradores e gestão pública na
            cidade de São Carlos – SP.
          </p>
        </div>

        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="card card-dashboard h-100">
              <div class="card-body">
                <h2 class="card-title h6 text-muted">
                  Total de pontos cadastrados
                </h2>
                <p class="display-6 mb-0" id="card-total-pontos">0</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card card-dashboard h-100">
              <div class="card-body">
                <h2 class="card-title h6 text-muted">
                  Pontos com coleta ativa
                </h2>
                <p class="display-6 mb-0" id="card-pontos-ativos">0</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card card-dashboard h-100">
              <div class="card-body">
                <h2 class="card-title h6 text-muted">Bairros atendidos</h2>
                <p class="display-6 mb-0" id="card-bairros">0</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <hr class="my-4" />
      <section
        id="cadastro"
        class="mb-4"
        aria-label="Cadastro de pontos de coleta"
      >
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="section-title mb-0">Cadastro de ponto de coleta</h2>
          <small class="text-muted"
            >Preencha os dados e adicione um novo ponto.</small
          >
        </div>

        <div class="row g-3">
          <div class="col-lg-5">
            <form id="form-ponto" class="card p-3 needs-validation" novalidate>
              <div class="mb-3">
                <label for="nomePonto" class="form-label"
                  >Nome do ponto *</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="nomePonto"
                  name="nomePonto"
                  required
                  placeholder="Ex.: Ponto 01 - Rua X, esquina com Y"
                />
                <div class="invalid-feedback">
                  Informe um nome para o ponto de coleta.
                </div>
              </div>

              <div class="mb-3">
                <label for="bairro" class="form-label">Bairro *</label>
                <input
                  type="text"
                  class="form-control"
                  id="bairro"
                  name="bairro"
                  required
                  placeholder="Ex.: Vila Prado"
                />
                <div class="invalid-feedback">Informe o bairro do ponto.</div>
              </div>

              <div class="mb-3">
                <label for="tipoResiduo" class="form-label"
                  >Tipo de resíduo *</label
                >
                <select
                  class="form-select"
                  id="tipoResiduo"
                  name="tipoResiduo"
                  required
                >
                  <option value="">Selecione...</option>
                  <option value="Doméstico">Doméstico</option>
                  <option value="Reciclável">Reciclável</option>
                  <option value="Orgânico">Orgânico</option>
                  <option value="Outros">Outros</option>
                </select>
                <div class="invalid-feedback">Selecione o tipo de resíduo.</div>
              </div>

              <div class="mb-3">
                <label for="diaSemana" class="form-label"
                  >Dia da coleta *</label
                >
                <select
                  class="form-select"
                  id="diaSemana"
                  name="diaSemana"
                  required
                >
                  <option value="">Selecione...</option>
                  <option value="Segunda-feira">Segunda-feira</option>
                  <option value="Terça-feira">Terça-feira</option>
                  <option value="Quarta-feira">Quarta-feira</option>
                  <option value="Quinta-feira">Quinta-feira</option>
                  <option value="Sexta-feira">Sexta-feira</option>
                  <option value="Sábado">Sábado</option>
                </select>
                <div class="invalid-feedback">Selecione o dia da coleta.</div>
              </div>

              <div class="mb-3">
                <label for="horario" class="form-label"
                  >Horário previsto *</label
                >
                <input
                  type="time"
                  class="form-control"
                  id="horario"
                  name="horario"
                  required
                />
                <div class="invalid-feedback">Informe um horário previsto.</div>
              </div>

              <div class="mb-3">
                <label for="status" class="form-label">Status do ponto *</label>
                <select class="form-select" id="status" name="status" required>
                  <option value="">Selecione...</option>
                  <option value="Ativo">Ativo</option>
                  <option value="Inativo">Inativo</option>
                </select>
                <div class="invalid-feedback">Informe o status do ponto.</div>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-success">
                  Adicionar ponto de coleta
                </button>
              </div>
            </form>
          </div>

          <div class="col-lg-7">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h3 class="h6 mb-0">Pontos cadastrados</h3>
              <div class="d-flex gap-2">
                <input
                  type="text"
                  id="filtro-bairro"
                  class="form-control form-control-sm"
                  placeholder="Filtrar por bairro"
                  aria-label="Filtrar pontos por bairro"
                />
                <select
                  id="filtro-dia"
                  class="form-select form-select-sm"
                  aria-label="Filtrar pontos por dia da semana"
                >
                  <option value="">Todos os dias</option>
                  <option value="Segunda-feira">Segunda-feira</option>
                  <option value="Terça-feira">Terça-feira</option>
                  <option value="Quarta-feira">Quarta-feira</option>
                  <option value="Quinta-feira">Quinta-feira</option>
                  <option value="Sexta-feira">Sexta-feira</option>
                  <option value="Sábado">Sábado</option>
                </select>
              </div>
            </div>

            <div class="table-responsive">
              <table
                class="table table-sm table-hover align-middle"
                aria-describedby="Tabela de pontos de coleta"
              >
                <thead class="table-light">
                  <tr>
                    <th scope="col">Ponto</th>
                    <th scope="col">Bairro</th>
                    <th scope="col">Tipo</th>
                    <th scope="col">Dia</th>
                    <th scope="col">Horário</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody id="tabela-pontos">
                </tbody>
              </table>
            </div>

            <p class="text-muted small mb-0">
              *Os dados são de demonstração (mock).
            </p>
          </div>
        </div>
      </section>

      <hr class="my-4" />

      <section
        id="ocorrencias"
        class="mb-4"
        aria-label="Registro de reclamações ou ocorrências"
      >
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="section-title mb-0">
            Registro de reclamações / ocorrências
          </h2>
          <small class="text-muted"
            >Moradores podem registrar problemas relacionados à coleta.</small
          >
        </div>

        <div class="row g-3">
          <div class="col-lg-5">
            <form
              id="form-ocorrencia"
              class="card p-3 needs-validation"
              novalidate
            >
              <div class="mb-3">
                <label for="ocorrencia-ponto" class="form-label"
                  >Ponto de coleta *</label
                >
                <select id="ocorrencia-ponto" class="form-select" required>
                  <option value="">Selecione...</option>
                </select>
                <div class="invalid-feedback">
                  Selecione o ponto relacionado à ocorrência.
                </div>
              </div>

              <div class="mb-3">
                <label for="ocorrencia-tipo" class="form-label"
                  >Tipo de ocorrência *</label
                >
                <select id="ocorrencia-tipo" class="form-select" required>
                  <option value="">Selecione...</option>
                  <option value="Atraso na coleta">Atraso na coleta</option>
                  <option value="Falta de coleta">Falta de coleta</option>
                  <option value="Lixo acumulado">Lixo acumulado</option>
                  <option value="Outros">Outros</option>
                </select>
                <div class="invalid-feedback">
                  Selecione o tipo de ocorrência.
                </div>
              </div>

              <div class="mb-3">
                <label for="ocorrencia-descricao" class="form-label"
                  >Descrição detalhada *</label
                >
                <textarea
                  id="ocorrencia-descricao"
                  class="form-control"
                  rows="4"
                  required
                  placeholder="Descreva o problema observado no local..."
                ></textarea>
                <div class="invalid-feedback">
                  Descreva brevemente o problema.
                </div>
              </div>

              <div class="mb-3">
                <label for="ocorrencia-contato" class="form-label">
                  Contato (opcional)
                </label>
                <input
                  type="text"
                  id="ocorrencia-contato"
                  class="form-control"
                  placeholder="E-mail ou telefone para retorno"
                />
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-warning">
                  Registrar ocorrência
                </button>
              </div>
            </form>
          </div>

          <div class="col-lg-7">
            <h3 class="h6 mb-2">Ocorrências registradas</h3>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Data</th>
                    <th scope="col">Ponto / Bairro</th>
                    <th scope="col">Tipo</th>
                    <th scope="col">Descrição</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody id="tabela-ocorrencias">
                  <tr>
                    <td colspan="5" class="text-muted text-center">
                      Nenhuma ocorrência registrada até o momento.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p class="text-muted small mb-0">
              *As ocorrências ficam associadas aos pontos de coleta cadastrados
              e podem ser utilizadas para priorizar ações da gestão pública.
            </p>
          </div>
        </div>
      </section>

      <hr class="my-4" />

      <section id="rotas" class="mb-5" aria-label="Consulta de rotas de coleta">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="section-title mb-0">Consulta de rotas</h2>
          <small class="text-muted"
            >Simulação de rotas com base nos pontos cadastrados.</small
          >
        </div>

        <div class="row g-3">
          <div class="col-md-4">
            <div class="card p-3">
              <form id="form-rota">
                <div class="mb-3">
                  <label for="rota-bairro" class="form-label">Bairro</label>
                  <input
                    type="text"
                    id="rota-bairro"
                    class="form-control"
                    placeholder="Ex.: Vila Prado"
                  />
                </div>

                <div class="mb-3">
                  <label for="rota-dia" class="form-label">Dia da semana</label>
                  <select id="rota-dia" class="form-select">
                    <option value="">Todos os dias</option>
                    <option value="Segunda-feira">Segunda-feira</option>
                    <option value="Terça-feira">Terça-feira</option>
                    <option value="Quarta-feira">Quarta-feira</option>
                    <option value="Quinta-feira">Quinta-feira</option>
                    <option value="Sexta-feira">Sexta-feira</option>
                    <option value="Sábado">Sábado</option>
                  </select>
                </div>

                <div class="d-grid">
                  <button type="submit" class="btn btn-outline-success">
                    Consultar rota
                  </button>
                </div>
              </form>
            </div>
          </div>

          <div class="col-md-8">
            <div class="card h-100">
              <div class="card-body">
                <h3 class="h6 mb-3">Resultado da consulta</h3>
                <ul class="list-group mb-3" id="lista-rotas">
                  <li class="list-group-item text-muted">
                    Nenhuma rota consultada ainda. Use o formulário ao lado para
                    visualizar.
                  </li>
                </ul>

                <p class="text-muted small mb-0">
                  *Nesta versão de protótipo, a rota é apresentada como uma
                  lista ordenada de pontos. Futuramente, pode ser integrada a um
                  mapa (Leaflet, Google Maps etc.).
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      const pontosDeColeta = [];
      const ocorrencias = [];

      const formPonto = document.getElementById("form-ponto");
      const tabelaPontos = document.getElementById("tabela-pontos");
      const filtroBairro = document.getElementById("filtro-bairro");
      const filtroDia = document.getElementById("filtro-dia");

      const cardTotalPontos = document.getElementById("card-total-pontos");
      const cardPontosAtivos = document.getElementById("card-pontos-ativos");
      const cardBairros = document.getElementById("card-bairros");

      const formOcorrencia = document.getElementById("form-ocorrencia");
      const selectPontoOcorrencia = document.getElementById("ocorrencia-ponto");
      const tabelaOcorrencias = document.getElementById("tabela-ocorrencias");
      const ocorrenciaTipo = document.getElementById("ocorrencia-tipo");
      const ocorrenciaDescricao = document.getElementById(
        "ocorrencia-descricao"
      );
      const ocorrenciaContato = document.getElementById("ocorrencia-contato");

      const formRota = document.getElementById("form-rota");
      const rotaBairro = document.getElementById("rota-bairro");
      const rotaDia = document.getElementById("rota-dia");
      const listaRotas = document.getElementById("lista-rotas");

      function atualizarDashboard() {
        cardTotalPontos.textContent = pontosDeColeta.length;

        const ativos = pontosDeColeta.filter(
          (p) => p.status === "Ativo"
        ).length;
        cardPontosAtivos.textContent = ativos;

        const bairrosUnicos = new Set(
          pontosDeColeta
            .map((p) => p.bairro.trim().toLowerCase())
            .filter((b) => b !== "")
        );
        cardBairros.textContent = bairrosUnicos.size;
      }

      function atualizarSelectPontosOcorrencias() {
        selectPontoOcorrencia.innerHTML = "";
        const optionInicial = document.createElement("option");
        optionInicial.value = "";
        optionInicial.textContent = "Selecione...";
        selectPontoOcorrencia.appendChild(optionInicial);

        if (pontosDeColeta.length === 0) {
          const opt = document.createElement("option");
          opt.disabled = true;
          opt.textContent = "Nenhum ponto cadastrado";
          selectPontoOcorrencia.appendChild(opt);
          return;
        }

        pontosDeColeta.forEach((p) => {
          const option = document.createElement("option");
          option.value = p.id;
          option.textContent = `${p.nomePonto} - ${p.bairro}`;
          selectPontoOcorrencia.appendChild(option);
        });
      }

      function renderizarTabela() {
        const bairroFiltro = filtroBairro.value.trim().toLowerCase();
        const diaFiltro = filtroDia.value;

        tabelaPontos.innerHTML = "";

        const pontosFiltrados = pontosDeColeta.filter((p) => {
          const bairroOk =
            bairroFiltro === "" ||
            p.bairro.toLowerCase().includes(bairroFiltro);
          const diaOk = diaFiltro === "" || p.diaSemana === diaFiltro;
          return bairroOk && diaOk;
        });

        if (pontosFiltrados.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 6;
          td.className = "text-muted text-center";
          td.textContent = "Nenhum ponto encontrado com os filtros atuais.";
          tr.appendChild(td);
          tabelaPontos.appendChild(tr);
          return;
        }

        pontosFiltrados.forEach((ponto) => {
          const tr = document.createElement("tr");

          const tdNome = document.createElement("td");
          tdNome.textContent = ponto.nomePonto;
          tr.appendChild(tdNome);

          const tdBairro = document.createElement("td");
          tdBairro.textContent = ponto.bairro;
          tr.appendChild(tdBairro);

          const tdTipo = document.createElement("td");
          tdTipo.textContent = ponto.tipoResiduo;
          tr.appendChild(tdTipo);

          const tdDia = document.createElement("td");
          tdDia.textContent = ponto.diaSemana;
          tr.appendChild(tdDia);

          const tdHorario = document.createElement("td");
          tdHorario.textContent = ponto.horario;
          tr.appendChild(tdHorario);

          const tdStatus = document.createElement("td");
          const spanStatus = document.createElement("span");
          spanStatus.classList.add("badge");

          if (ponto.status === "Ativo") {
            spanStatus.classList.add("badge-status-ativo");
          } else {
            spanStatus.classList.add("badge-status-inativo");
          }

          spanStatus.textContent = ponto.status;
          tdStatus.appendChild(spanStatus);
          tr.appendChild(tdStatus);

          tabelaPontos.appendChild(tr);
        });
      }

      function renderizarOcorrencias() {
        tabelaOcorrencias.innerHTML = "";

        if (ocorrencias.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 5;
          td.className = "text-muted text-center";
          td.textContent = "Nenhuma ocorrência registrada até o momento.";
          tr.appendChild(td);
          tabelaOcorrencias.appendChild(tr);
          return;
        }

        ocorrencias.forEach((oc) => {
          const tr = document.createElement("tr");

          const tdData = document.createElement("td");
          tdData.textContent = oc.data;
          tr.appendChild(tdData);

          const tdPonto = document.createElement("td");
          tdPonto.innerHTML = `<strong>${oc.pontoNome}</strong><br /><span class="text-muted small">${oc.bairro}</span>`;
          tr.appendChild(tdPonto);

          const tdTipo = document.createElement("td");
          tdTipo.textContent = oc.tipo;
          tr.appendChild(tdTipo);

          const tdDescricao = document.createElement("td");
          tdDescricao.textContent = oc.descricao;
          tr.appendChild(tdDescricao);

          const tdStatus = document.createElement("td");
          const badge = document.createElement("span");
          badge.classList.add("badge", "bg-warning", "text-dark");
          badge.textContent = oc.status;
          tdStatus.appendChild(badge);
          tr.appendChild(tdStatus);

          tabelaOcorrencias.appendChild(tr);
        });
      }

      formPonto.addEventListener("submit", (event) => {
        event.preventDefault();

        if (!formPonto.checkValidity()) {
          event.stopPropagation();
          formPonto.classList.add("was-validated");
          return;
        }

        const novoPonto = {
          id: Date.now(),
          nomePonto: document.getElementById("nomePonto").value.trim(),
          bairro: document.getElementById("bairro").value.trim(),
          tipoResiduo: document.getElementById("tipoResiduo").value,
          diaSemana: document.getElementById("diaSemana").value,
          horario: document.getElementById("horario").value,
          status: document.getElementById("status").value,
        };

        pontosDeColeta.push(novoPonto);

        formPonto.reset();
        formPonto.classList.remove("was-validated");

        atualizarDashboard();
        renderizarTabela();
        atualizarSelectPontosOcorrencias();
      });

      filtroBairro.addEventListener("input", renderizarTabela);
      filtroDia.addEventListener("change", renderizarTabela);

      formOcorrencia.addEventListener("submit", (event) => {
        event.preventDefault();

        if (!formOcorrencia.checkValidity()) {
          event.stopPropagation();
          formOcorrencia.classList.add("was-validated");
          return;
        }

        const pontoId = parseInt(selectPontoOcorrencia.value, 10);
        const pontoRelacionado = pontosDeColeta.find((p) => p.id === pontoId);

        const novaOcorrencia = {
          id: Date.now(),
          pontoId: pontoId,
          pontoNome: pontoRelacionado
            ? pontoRelacionado.nomePonto
            : "Ponto não identificado",
          bairro: pontoRelacionado ? pontoRelacionado.bairro : "",
          tipo: ocorrenciaTipo.value,
          descricao: ocorrenciaDescricao.value.trim(),
          contato: ocorrenciaContato.value.trim(),
          status: "Aberta",
          data: new Date().toLocaleString("pt-BR"),
        };

        ocorrencias.push(novaOcorrencia);

        formOcorrencia.reset();
        formOcorrencia.classList.remove("was-validated");

        renderizarOcorrencias();
      });

      formRota.addEventListener("submit", (event) => {
        event.preventDefault();

        const bairro = rotaBairro.value.trim().toLowerCase();
        const dia = rotaDia.value;

        listaRotas.innerHTML = "";

        let pontosFiltrados = pontosDeColeta.filter(
          (p) => p.status === "Ativo"
        );

        if (bairro !== "") {
          pontosFiltrados = pontosFiltrados.filter((p) =>
            p.bairro.toLowerCase().includes(bairro)
          );
        }

        if (dia !== "") {
          pontosFiltrados = pontosFiltrados.filter((p) => p.diaSemana === dia);
        }

       pontosFiltrados.sort((a, b) => {
          if (a.diaSemana === b.diaSemana) {
            return a.horario.localeCompare(b.horario);
          }
          return a.diaSemana.localeCompare(b.diaSemana);
        });

        if (pontosFiltrados.length === 0) {
          const li = document.createElement("li");
          li.className = "list-group-item text-muted";
          li.textContent =
            "Nenhum ponto encontrado para os filtros informados.";
          listaRotas.appendChild(li);
          return;
        }

        pontosFiltrados.forEach((ponto, index) => {
          const li = document.createElement("li");
          li.className = "list-group-item";

          li.innerHTML = `
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>Parada ${index + 1}:</strong> ${ponto.nomePonto}<br />
              <span class="text-muted small">
                Bairro: ${ponto.bairro} • Dia: ${ponto.diaSemana} • Horário: ${
            ponto.horario
          }
              </span><br />
              <span class="small">Tipo de resíduo: ${ponto.tipoResiduo}</span>
            </div>
          </div>
        `;

          listaRotas.appendChild(li);
        });
      });

      atualizarDashboard();
      renderizarTabela();
      atualizarSelectPontosOcorrencias();
      renderizarOcorrencias();
    </script>
  </body>
</html>
